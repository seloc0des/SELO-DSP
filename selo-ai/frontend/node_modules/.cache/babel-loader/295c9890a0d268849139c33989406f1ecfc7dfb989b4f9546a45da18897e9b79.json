{"ast":null,"code":"import React,{useEffect,useState,useCallback}from'react';import{getApiBaseUrl}from'../../services/config';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Banner=_ref=>{let{children,tone='info'}=_ref;const toneClasses=tone==='ok'?'border-[var(--color-border)] text-[var(--color-text-muted)]':tone==='warn'?'border-[var(--color-accent)] text-[var(--color-accent)]':'border-[var(--color-border)] text-[var(--color-text-secondary)]';return/*#__PURE__*/_jsx(\"div\",{className:`w-full bg-[var(--color-bg-elev-1)] border ${toneClasses} px-3 py-2 text-xs`,children:children});};export default function DiagnosticsBanner(){const[loading,setLoading]=useState(true);const[status,setStatus]=useState('unknown');// ok | warn | unknown\nconst[message,setMessage]=useState('');const[details,setDetails]=useState(null);const load=useCallback(async()=>{setLoading(true);try{const base=await getApiBaseUrl();const res=await fetch(`${base}/diagnostics/gpu?test_llm=false`);const data=await res.json();setDetails(data);const cuda=!!(data!==null&&data!==void 0&&data.cuda_detected);const env=(data===null||data===void 0?void 0:data.ollama)||{};const numGpu=env===null||env===void 0?void 0:env.num_gpu;const gpuLayers=env===null||env===void 0?void 0:env.gpu_layers;const likelyGpuEnabled=cuda&&(numGpu===undefined||numGpu===null||String(numGpu)==='1'||String(numGpu)==='-1'||String(numGpu).toLowerCase()==='true');if(likelyGpuEnabled){setStatus('ok');setMessage('GPU available. Ollama appears configured for GPU offload.');}else{setStatus('warn');setMessage('GPU not detected or Ollama GPU offload disabled. Running on CPU may cause high usage.');}}catch(e){setStatus('warn');setMessage('Unable to fetch GPU diagnostics. The app may still function, but performance insights are unavailable.');}finally{setLoading(false);}},[]);useEffect(()=>{let alive=true;(async()=>{if(alive)await load();})();const id=setInterval(()=>{load();},60000);// refresh every 60s\nreturn()=>{alive=false;clearInterval(id);};},[load]);const tone=status==='ok'?'ok':status==='warn'?'warn':'info';return/*#__PURE__*/_jsx(Banner,{tone:tone,children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm\",children:loading?'Checking GPU/CPU status…':message}),(details===null||details===void 0?void 0:details.nvidia_smi_present)!==undefined&&/*#__PURE__*/_jsxs(\"span\",{className:\"hidden sm:inline text-[var(--color-text-muted)]\",children:[\"nvidia-smi: \",details.nvidia_smi_present?'present':'absent']}),(details===null||details===void 0?void 0:details.cuda_detected)!==undefined&&/*#__PURE__*/_jsxs(\"span\",{className:\"hidden sm:inline text-[var(--color-text-muted)]\",children:[\"CUDA: \",details.cuda_detected?'detected':'not detected']})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center gap-2\"})]})});}","map":{"version":3,"names":["React","useEffect","useState","useCallback","getApiBaseUrl","jsx","_jsx","jsxs","_jsxs","Banner","_ref","children","tone","toneClasses","className","DiagnosticsBanner","loading","setLoading","status","setStatus","message","setMessage","details","setDetails","load","base","res","fetch","data","json","cuda","cuda_detected","env","ollama","numGpu","num_gpu","gpuLayers","gpu_layers","likelyGpuEnabled","undefined","String","toLowerCase","e","alive","id","setInterval","clearInterval","nvidia_smi_present"],"sources":["/mnt/local/Projects/SELODSP1/selo-ai/frontend/src/components/System/DiagnosticsBanner.jsx"],"sourcesContent":["import React, { useEffect, useState, useCallback } from 'react';\nimport { getApiBaseUrl } from '../../services/config';\n\nconst Banner = ({ children, tone = 'info' }) => {\n  const toneClasses = tone === 'ok'\n    ? 'border-[var(--color-border)] text-[var(--color-text-muted)]'\n    : tone === 'warn'\n      ? 'border-[var(--color-accent)] text-[var(--color-accent)]'\n      : 'border-[var(--color-border)] text-[var(--color-text-secondary)]';\n  return (\n    <div className={`w-full bg-[var(--color-bg-elev-1)] border ${toneClasses} px-3 py-2 text-xs`}>{children}</div>\n  );\n};\n\nexport default function DiagnosticsBanner() {\n  const [loading, setLoading] = useState(true);\n  const [status, setStatus] = useState('unknown'); // ok | warn | unknown\n  const [message, setMessage] = useState('');\n  const [details, setDetails] = useState(null);\n\n  const load = useCallback(async () => {\n    setLoading(true);\n    try {\n      const base = await getApiBaseUrl();\n      const res = await fetch(`${base}/diagnostics/gpu?test_llm=false`);\n      const data = await res.json();\n      setDetails(data);\n      const cuda = !!data?.cuda_detected;\n      const env = data?.ollama || {};\n      const numGpu = env?.num_gpu;\n      const gpuLayers = env?.gpu_layers;\n      const likelyGpuEnabled = cuda && (numGpu === undefined || numGpu === null || String(numGpu) === '1' || String(numGpu) === '-1' || String(numGpu).toLowerCase() === 'true');\n      if (likelyGpuEnabled) {\n        setStatus('ok');\n        setMessage('GPU available. Ollama appears configured for GPU offload.');\n      } else {\n        setStatus('warn');\n        setMessage('GPU not detected or Ollama GPU offload disabled. Running on CPU may cause high usage.');\n      }\n    } catch (e) {\n      setStatus('warn');\n      setMessage('Unable to fetch GPU diagnostics. The app may still function, but performance insights are unavailable.');\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  useEffect(() => {\n    let alive = true;\n    (async () => { if (alive) await load(); })();\n    const id = setInterval(() => { load(); }, 60000); // refresh every 60s\n    return () => { alive = false; clearInterval(id); };\n  }, [load]);\n\n  const tone = status === 'ok' ? 'ok' : status === 'warn' ? 'warn' : 'info';\n\n  return (\n    <Banner tone={tone}>\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-2\">\n          <span className=\"text-sm\">\n            {loading ? 'Checking GPU/CPU status…' : message}\n          </span>\n          {details?.nvidia_smi_present !== undefined && (\n            <span className=\"hidden sm:inline text-[var(--color-text-muted)]\">\n              nvidia-smi: {details.nvidia_smi_present ? 'present' : 'absent'}\n            </span>\n          )}\n          {details?.cuda_detected !== undefined && (\n            <span className=\"hidden sm:inline text-[var(--color-text-muted)]\">\n              CUDA: {details.cuda_detected ? 'detected' : 'not detected'}\n            </span>\n          )}\n        </div>\n        <div className=\"flex items-center gap-2\" />\n      </div>\n    </Banner>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}