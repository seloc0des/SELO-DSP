{"ast":null,"code":"import React,{useState,useRef,useEffect}from'react';import{v4 as uuidv4}from'uuid';import ReflectionPanel from'./ReflectionPanel';import{reflectionService}from'../services/reflectionService';import{getApiBaseUrl}from'../services/config';import{formatRelativeTime}from'../utils/dateFormatter';// Runtime-resolved API base URL\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const trimTrailingSlash=s=>s.replace(/\\/$/,'');// Enforce strict reflection-first UX (no assistant release without matching reflection)\nconst STRICT_REFLECTION_FIRST=true;const Chat=_ref=>{let{userId}=_ref;const[messages,setMessages]=useState([]);const[input,setInput]=useState('');const[isLoading,setIsLoading]=useState(false);const[reflectingCount,setReflectingCount]=useState(0);const[apiBase,setApiBase]=useState(null);// Map of turnId -> assistant message content waiting for matching reflection\nconst pendingAnswersRef=useRef(new Map());const reflectionsSeenRef=useRef(new Set());const[sessionId,setSessionId]=useState(null);// Track per-turn timeouts for releasing pending assistant messages if reflection is delayed\nconst pendingTimeoutsRef=useRef(new Map());const messagesEndRef=useRef(null);// Auto-scroll to bottom when messages change\nuseEffect(()=>{var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:'smooth'});},[messages]);// Cleanup pending timeouts on unmount to prevent memory leaks\nuseEffect(()=>{return()=>{// Clear all pending timeouts when component unmounts\npendingTimeoutsRef.current.forEach(timeoutId=>{clearTimeout(timeoutId);});pendingTimeoutsRef.current.clear();};},[]);// Resolve API base URL at runtime via backend /config.json (with fallbacks inside getApiBaseUrl)\nuseEffect(()=>{let mounted=true;(async()=>{try{const base=await getApiBaseUrl();if(mounted)setApiBase(base);}catch(e){console.warn('Failed to resolve API base URL:',e);if(mounted)setApiBase('http://localhost:8000');}})();return()=>{mounted=false;};},[]);// Establish a single, consistent session id across the app. Prefer App's userId prop.\nuseEffect(()=>{// If App provided a userId, use it and persist to localStorage for continuity\nif(userId&&typeof userId==='string'){setSessionId(userId);try{localStorage.setItem('selo_ai_session_id',userId);}catch(_){}return;}// Fallback to existing persisted session id or create a new one\nlet sid=null;try{sid=localStorage.getItem('selo_ai_session_id');}catch(_){sid=null;}if(!sid){sid=uuidv4();try{localStorage.setItem('selo_ai_session_id',sid);}catch(_){}}setSessionId(sid);},[userId]);// Load conversation history when sessionId is available\nuseEffect(()=>{if(!sessionId||!apiBase)return;const loadConversationHistory=async()=>{try{const response=await fetch(`${trimTrailingSlash(apiBase)}/conversations/history?session_id=${sessionId}`,{method:'GET',headers:{'Content-Type':'application/json'}});if(response.ok){const data=await response.json();if(data.messages&&Array.isArray(data.messages)){// Convert backend message format to frontend format\nconst formattedMessages=data.messages.map(msg=>({role:msg.role==='user'?'user':'assistant',content:msg.content,timestamp:msg.timestamp||null}));setMessages(formattedMessages);}}}catch(error){console.warn('[Chat] Failed to load conversation history:',error);// Don't show error to user, just start with empty conversation\n}};loadConversationHistory();},[sessionId,apiBase]);// Subscribe to reflections: show a visible \"Reflecting…\" indicator during generation and\n// release pending assistant messages when matching turn_id arrives\nuseEffect(()=>{if(!sessionId)return;const unsubscribe=reflectionService.onReflectionGenerated(evt=>{// Reflection service emits both generating and generated events to this listener.\n// evt.status can be 'generating' | 'complete'.\nconst base=evt||{};if(base.status==='generating'){// Show indicator\nsetReflectingCount(c=>c+1);}const payload=(base===null||base===void 0?void 0:base.data)||base;if(!payload)return;const{turn_id,user_profile_id}=payload;if(!turn_id)return;if(user_profile_id&&user_profile_id!==sessionId)return;if(base.status==='complete'){// Hide indicator (decrement counter; guard below zero)\nsetReflectingCount(c=>Math.max(0,c-1));reflectionsSeenRef.current.add(turn_id);if(pendingAnswersRef.current.has(turn_id)){const pending=pendingAnswersRef.current.get(turn_id);pendingAnswersRef.current.delete(turn_id);// Clear any pending timeout for this turn\nconst t=pendingTimeoutsRef.current.get(turn_id);if(t){clearTimeout(t);pendingTimeoutsRef.current.delete(turn_id);}setMessages(prev=>[...prev,{role:'assistant',content:(pending===null||pending===void 0?void 0:pending.content)||'',timestamp:(pending===null||pending===void 0?void 0:pending.timestamp)||new Date().toISOString()}]);}else if(pendingAnswersRef.current.size===1){// Fallback: if exactly one pending answer exists for this session but the turn_id didn't match,\n// release it to avoid a stuck UI due to rare id mismatch races.\ntry{console.warn('[Reflect] releasing unmatched pending assistant due to single-pending fallback');}catch(_){}const[[k,v]]=Array.from(pendingAnswersRef.current.entries());pendingAnswersRef.current.delete(k);const t2=pendingTimeoutsRef.current.get(k);if(t2){clearTimeout(t2);pendingTimeoutsRef.current.delete(k);}setMessages(prev=>[...prev,{role:'assistant',content:v&&v.content||'',timestamp:v&&v.timestamp||new Date().toISOString()}]);}}},sessionId);return()=>{if(typeof unsubscribe==='function')unsubscribe();};},[sessionId]);const clearConversation=()=>{setMessages([]);// Optionally generate a new session ID to start fresh\nconst newSessionId=uuidv4();setSessionId(newSessionId);try{localStorage.setItem('selo_ai_session_id',newSessionId);}catch(_){}};const handleSubmit=async e=>{e.preventDefault();if(!input.trim()||isLoading||!apiBase||!sessionId)return;const nowIso=new Date().toISOString();const userMessage={role:'user',content:input,timestamp:nowIso};setMessages(prev=>[...prev,userMessage]);setInput('');setIsLoading(true);try{const CHAT_ENDPOINT=`${trimTrailingSlash(apiBase)}/chat`;// Debug logging removed for production\nconst response=await fetch(CHAT_ENDPOINT,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({session_id:sessionId,prompt:input})});if(!response.ok){const text=await response.text().catch(()=>'');try{console.error('[Chat] /chat non-OK',response.status,text);}catch(_){}throw new Error('Network response was not ok');}const data=await response.json();// Debug logging removed for production\nconst turnId=data.turn_id;const assistantContent=data.response;const assistantTimestamp=data.timestamp||new Date().toISOString();// Prefer showing reflection first. Gate assistant until matching reflection arrives,\n// but fall back after a short timeout to prevent indefinite blocking.\nif(turnId){if(reflectionsSeenRef.current.has(turnId)){setMessages(prev=>[...prev,{role:'assistant',content:assistantContent,timestamp:assistantTimestamp}]);}else{pendingAnswersRef.current.set(turnId,{content:assistantContent,timestamp:assistantTimestamp});// Optional fallback release is disabled when STRICT_REFLECTION_FIRST is true\nif(!STRICT_REFLECTION_FIRST){const timeoutId=setTimeout(()=>{if(pendingAnswersRef.current.has(turnId)){const pending=pendingAnswersRef.current.get(turnId);pendingAnswersRef.current.delete(turnId);pendingTimeoutsRef.current.delete(turnId);setMessages(prev=>[...prev,{role:'assistant',content:(pending===null||pending===void 0?void 0:pending.content)||assistantContent,timestamp:(pending===null||pending===void 0?void 0:pending.timestamp)||assistantTimestamp}]);}},8000);pendingTimeoutsRef.current.set(turnId,timeoutId);}}}else{// No turn_id returned, show immediately\nsetMessages(prev=>[...prev,{role:'assistant',content:assistantContent,timestamp:assistantTimestamp}]);}}catch(error){console.error('[Chat] submit error:',error);setMessages(prev=>[...prev,{role:'assistant',content:'Sorry, there was an error processing your request. Please try again.',timestamp:new Date().toISOString()}]);}finally{setIsLoading(false);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"flex h-full w-full\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col flex-1 h-full max-w-2xl min-w-0\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 overflow-y-auto p-4 space-y-4 mb-4\",children:[reflectingCount>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2 text-[var(--color-accent)] mb-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-2 h-2 bg-[var(--color-accent)] rounded-full animate-pulse\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm\",children:\"Reflecting\\u2026\"})]}),!apiBase?/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center h-full\",children:/*#__PURE__*/_jsx(\"div\",{className:\"text-center text-gray-500\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-sm\",children:\"Loading configuration...\"})})}):messages.length===0?/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center h-full\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center text-gray-500\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-lg mb-2\",children:\"Welcome to SELO DSP\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm\",children:\"Start a conversation with your SELO\"})]})}):messages.map((message,index)=>{const displayTime=formatRelativeTime(message.timestamp);return/*#__PURE__*/_jsx(\"div\",{className:`flex ${message.role==='user'?'justify-end':'justify-start'}`,children:/*#__PURE__*/_jsxs(\"div\",{className:`max-w-[75%] rounded-lg p-4 ${message.role==='user'?'bg-[var(--color-bg-elev-1)] border border-[var(--color-accent)]/40 text-white':'bg-[var(--color-bg-elev-1)] border border-[var(--color-border)] text-[var(--color-text-secondary)]'}`,children:[/*#__PURE__*/_jsx(\"div\",{className:\"whitespace-pre-wrap\",children:message.content}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-2 text-xs text-[var(--color-text-muted)] text-right\",children:displayTime})]})},index);}),isLoading&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2 text-[var(--color-accent)]\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-2 h-2 bg-[var(--color-accent)] rounded-full animate-pulse\"}),/*#__PURE__*/_jsx(\"div\",{className:\"w-2 h-2 bg-[var(--color-accent)] rounded-full animate-pulse delay-150\"}),/*#__PURE__*/_jsx(\"div\",{className:\"w-2 h-2 bg-[var(--color-accent)] rounded-full animate-pulse delay-300\"}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-2 text-sm\",children:\"SELO DSP is thinking...\"})]}),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]}),/*#__PURE__*/_jsx(\"form\",{onSubmit:handleSubmit,className:\"mt-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-2\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:input,onChange:e=>setInput(e.target.value),placeholder:\"Type your message...\",className:\"flex-1 bg-[var(--color-bg-elev-1)] border border-[var(--color-border)] rounded-lg px-4 py-2 text-white focus:outline-none\",disabled:isLoading}),messages.length>0&&/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:clearConversation,className:\"px-4 py-2 bg-[var(--color-bg-elev-1)] hover:bg-[var(--color-bg-elev-2)] text-gray-400 hover:text-white border border-[var(--color-border)] rounded-lg font-medium transition-colors\",title:\"Clear conversation\",children:\"Clear\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:!input.trim()||isLoading,className:\"px-6 py-2 bg-[var(--color-bg-elev-1)] hover:bg-[var(--color-bg-elev-2)] text-[var(--color-accent)] border border-[var(--color-accent)]/50 rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed\",children:\"Send\"})]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"hidden md:block md:w-[420px] md:min-w-[320px] md:max-w-[520px] h-full border-l border-[var(--color-border)] bg-[var(--color-bg-elev-1)]\",children:/*#__PURE__*/_jsx(ReflectionPanel,{sessionId:sessionId,messages:messages})})]});};export default Chat;","map":{"version":3,"names":["React","useState","useRef","useEffect","v4","uuidv4","ReflectionPanel","reflectionService","getApiBaseUrl","formatRelativeTime","jsx","_jsx","jsxs","_jsxs","trimTrailingSlash","s","replace","STRICT_REFLECTION_FIRST","Chat","_ref","userId","messages","setMessages","input","setInput","isLoading","setIsLoading","reflectingCount","setReflectingCount","apiBase","setApiBase","pendingAnswersRef","Map","reflectionsSeenRef","Set","sessionId","setSessionId","pendingTimeoutsRef","messagesEndRef","_messagesEndRef$curre","current","scrollIntoView","behavior","forEach","timeoutId","clearTimeout","clear","mounted","base","e","console","warn","localStorage","setItem","_","sid","getItem","loadConversationHistory","response","fetch","method","headers","ok","data","json","Array","isArray","formattedMessages","map","msg","role","content","timestamp","error","unsubscribe","onReflectionGenerated","evt","status","c","payload","turn_id","user_profile_id","Math","max","add","has","pending","get","delete","t","prev","Date","toISOString","size","k","v","from","entries","t2","clearConversation","newSessionId","handleSubmit","preventDefault","trim","nowIso","userMessage","CHAT_ENDPOINT","body","JSON","stringify","session_id","prompt","text","catch","Error","turnId","assistantContent","assistantTimestamp","set","setTimeout","className","children","length","message","index","displayTime","ref","onSubmit","type","value","onChange","target","placeholder","disabled","onClick","title"],"sources":["/mnt/local/Projects/SELODSP1/selo-ai/frontend/src/components/Chat.jsx"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\nimport { v4 as uuidv4 } from 'uuid';\nimport ReflectionPanel from './ReflectionPanel';\nimport { reflectionService } from '../services/reflectionService';\nimport { getApiBaseUrl } from '../services/config';\nimport { formatRelativeTime } from '../utils/dateFormatter';\n\n// Runtime-resolved API base URL\nconst trimTrailingSlash = (s) => s.replace(/\\/$/, '');\n// Enforce strict reflection-first UX (no assistant release without matching reflection)\nconst STRICT_REFLECTION_FIRST = true;\n\nconst Chat = ({ userId }) => {\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [reflectingCount, setReflectingCount] = useState(0);\n  const [apiBase, setApiBase] = useState(null);\n  // Map of turnId -> assistant message content waiting for matching reflection\n  const pendingAnswersRef = useRef(new Map());\n  const reflectionsSeenRef = useRef(new Set());\n  const [sessionId, setSessionId] = useState(null);\n  // Track per-turn timeouts for releasing pending assistant messages if reflection is delayed\n  const pendingTimeoutsRef = useRef(new Map());\n  \n  const messagesEndRef = useRef(null);\n\n  // Auto-scroll to bottom when messages change\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [messages]);\n\n  // Cleanup pending timeouts on unmount to prevent memory leaks\n  useEffect(() => {\n    return () => {\n      // Clear all pending timeouts when component unmounts\n      pendingTimeoutsRef.current.forEach(timeoutId => {\n        clearTimeout(timeoutId);\n      });\n      pendingTimeoutsRef.current.clear();\n    };\n  }, []);\n\n  // Resolve API base URL at runtime via backend /config.json (with fallbacks inside getApiBaseUrl)\n  useEffect(() => {\n    let mounted = true;\n    (async () => {\n      try {\n        const base = await getApiBaseUrl();\n        if (mounted) setApiBase(base);\n      } catch (e) {\n        console.warn('Failed to resolve API base URL:', e);\n        if (mounted) setApiBase('http://localhost:8000');\n      }\n    })();\n    return () => { mounted = false; };\n  }, []);\n\n  // Establish a single, consistent session id across the app. Prefer App's userId prop.\n  useEffect(() => {\n    // If App provided a userId, use it and persist to localStorage for continuity\n    if (userId && typeof userId === 'string') {\n      setSessionId(userId);\n      try { localStorage.setItem('selo_ai_session_id', userId); } catch (_) {}\n      return;\n    }\n    // Fallback to existing persisted session id or create a new one\n    let sid = null;\n    try { sid = localStorage.getItem('selo_ai_session_id'); } catch (_) { sid = null; }\n    if (!sid) {\n      sid = uuidv4();\n      try { localStorage.setItem('selo_ai_session_id', sid); } catch (_) {}\n    }\n    setSessionId(sid);\n  }, [userId]);\n\n  // Load conversation history when sessionId is available\n  useEffect(() => {\n    if (!sessionId || !apiBase) return;\n    \n    const loadConversationHistory = async () => {\n      try {\n        const response = await fetch(`${trimTrailingSlash(apiBase)}/conversations/history?session_id=${sessionId}`, {\n          method: 'GET',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n        });\n        \n        if (response.ok) {\n          const data = await response.json();\n          if (data.messages && Array.isArray(data.messages)) {\n            // Convert backend message format to frontend format\n            const formattedMessages = data.messages.map(msg => ({\n              role: msg.role === 'user' ? 'user' : 'assistant',\n              content: msg.content,\n              timestamp: msg.timestamp || null,\n            }));\n            setMessages(formattedMessages);\n          }\n        }\n      } catch (error) {\n        console.warn('[Chat] Failed to load conversation history:', error);\n        // Don't show error to user, just start with empty conversation\n      }\n    };\n    \n    loadConversationHistory();\n  }, [sessionId, apiBase]);\n\n  // Subscribe to reflections: show a visible \"Reflecting…\" indicator during generation and\n  // release pending assistant messages when matching turn_id arrives\n  useEffect(() => {\n    if (!sessionId) return;\n    const unsubscribe = reflectionService.onReflectionGenerated((evt) => {\n      // Reflection service emits both generating and generated events to this listener.\n      // evt.status can be 'generating' | 'complete'.\n      const base = evt || {};\n      if (base.status === 'generating') {\n        // Show indicator\n        setReflectingCount((c) => c + 1);\n      }\n      const payload = base?.data || base;\n      if (!payload) return;\n      const { turn_id, user_profile_id } = payload;\n      if (!turn_id) return;\n      if (user_profile_id && user_profile_id !== sessionId) return;\n\n      if (base.status === 'complete') {\n        // Hide indicator (decrement counter; guard below zero)\n        setReflectingCount((c) => Math.max(0, c - 1));\n        reflectionsSeenRef.current.add(turn_id);\n        if (pendingAnswersRef.current.has(turn_id)) {\n          const pending = pendingAnswersRef.current.get(turn_id);\n          pendingAnswersRef.current.delete(turn_id);\n          // Clear any pending timeout for this turn\n          const t = pendingTimeoutsRef.current.get(turn_id);\n          if (t) { clearTimeout(t); pendingTimeoutsRef.current.delete(turn_id); }\n          setMessages((prev) => [...prev, {\n            role: 'assistant',\n            content: pending?.content || '',\n            timestamp: pending?.timestamp || new Date().toISOString(),\n          }]);\n        } else if (pendingAnswersRef.current.size === 1) {\n          // Fallback: if exactly one pending answer exists for this session but the turn_id didn't match,\n          // release it to avoid a stuck UI due to rare id mismatch races.\n          try { console.warn('[Reflect] releasing unmatched pending assistant due to single-pending fallback'); } catch (_) {}\n          const [[k, v]] = Array.from(pendingAnswersRef.current.entries());\n          pendingAnswersRef.current.delete(k);\n          const t2 = pendingTimeoutsRef.current.get(k);\n          if (t2) { clearTimeout(t2); pendingTimeoutsRef.current.delete(k); }\n          setMessages((prev) => [...prev, {\n            role: 'assistant',\n            content: (v && v.content) || '',\n            timestamp: (v && v.timestamp) || new Date().toISOString(),\n          }]);\n        }\n      }\n    }, sessionId);\n\n    return () => {\n      if (typeof unsubscribe === 'function') unsubscribe();\n    };\n  }, [sessionId]);\n\n  const clearConversation = () => {\n    setMessages([]);\n    // Optionally generate a new session ID to start fresh\n    const newSessionId = uuidv4();\n    setSessionId(newSessionId);\n    try { \n      localStorage.setItem('selo_ai_session_id', newSessionId); \n    } catch (_) {}\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    if (!input.trim() || isLoading || !apiBase || !sessionId) return;\n\n    const nowIso = new Date().toISOString();\n    const userMessage = { role: 'user', content: input, timestamp: nowIso };\n    setMessages(prev => [...prev, userMessage]);\n    setInput('');\n    setIsLoading(true);\n\n    try {\n      const CHAT_ENDPOINT = `${trimTrailingSlash(apiBase)}/chat`;\n      // Debug logging removed for production\n      const response = await fetch(CHAT_ENDPOINT, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          session_id: sessionId,\n          prompt: input,\n        }),\n      });\n\n      if (!response.ok) {\n        const text = await response.text().catch(() => '');\n        try { console.error('[Chat] /chat non-OK', response.status, text); } catch (_) {}\n        throw new Error('Network response was not ok');\n      }\n\n      const data = await response.json();\n      // Debug logging removed for production\n      const turnId = data.turn_id;\n      const assistantContent = data.response;\n      const assistantTimestamp = data.timestamp || new Date().toISOString();\n      // Prefer showing reflection first. Gate assistant until matching reflection arrives,\n      // but fall back after a short timeout to prevent indefinite blocking.\n      if (turnId) {\n        if (reflectionsSeenRef.current.has(turnId)) {\n          setMessages(prev => [...prev, { role: 'assistant', content: assistantContent, timestamp: assistantTimestamp }]);\n        } else {\n          pendingAnswersRef.current.set(turnId, { content: assistantContent, timestamp: assistantTimestamp });\n          // Optional fallback release is disabled when STRICT_REFLECTION_FIRST is true\n          if (!STRICT_REFLECTION_FIRST) {\n            const timeoutId = setTimeout(() => {\n              if (pendingAnswersRef.current.has(turnId)) {\n                const pending = pendingAnswersRef.current.get(turnId);\n                pendingAnswersRef.current.delete(turnId);\n                pendingTimeoutsRef.current.delete(turnId);\n                setMessages(prev => [...prev, { role: 'assistant', content: pending?.content || assistantContent, timestamp: pending?.timestamp || assistantTimestamp }]);\n              }\n            }, 8000);\n            pendingTimeoutsRef.current.set(turnId, timeoutId);\n          }\n        }\n      } else {\n        // No turn_id returned, show immediately\n        setMessages(prev => [...prev, { role: 'assistant', content: assistantContent, timestamp: assistantTimestamp }]);\n      }\n    } catch (error) {\n      console.error('[Chat] submit error:', error);\n      setMessages(prev => [...prev, {\n        role: 'assistant',\n        content: 'Sorry, there was an error processing your request. Please try again.',\n        timestamp: new Date().toISOString(),\n      }]);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"flex h-full w-full\">\n      {/* Chat panel (left) */}\n      <div className=\"flex flex-col flex-1 h-full max-w-2xl min-w-0\">\n        <div className=\"flex-1 overflow-y-auto p-4 space-y-4 mb-4\">\n          {reflectingCount > 0 && (\n            <div className=\"flex items-center space-x-2 text-[var(--color-accent)] mb-2\">\n              <div className=\"w-2 h-2 bg-[var(--color-accent)] rounded-full animate-pulse\"></div>\n              <span className=\"text-sm\">Reflecting…</span>\n            </div>\n          )}\n          {!apiBase ? (\n            <div className=\"flex items-center justify-center h-full\">\n              <div className=\"text-center text-gray-500\">\n                <p className=\"text-sm\">Loading configuration...</p>\n              </div>\n            </div>\n          ) : messages.length === 0 ? (\n            <div className=\"flex items-center justify-center h-full\">\n              <div className=\"text-center text-gray-500\">\n                <p className=\"text-lg mb-2\">Welcome to SELO DSP</p>\n                <p className=\"text-sm\">Start a conversation with your SELO</p>\n              </div>\n            </div>\n          ) : (\n            messages.map((message, index) => {\n              const displayTime = formatRelativeTime(message.timestamp);\n              return (\n                <div\n                  key={index}\n                  className={`flex ${message.role === 'user' ? 'justify-end' : 'justify-start'}`}\n                >\n                  <div\n                    className={`max-w-[75%] rounded-lg p-4 ${\n                      message.role === 'user'\n                        ? 'bg-[var(--color-bg-elev-1)] border border-[var(--color-accent)]/40 text-white'\n                        : 'bg-[var(--color-bg-elev-1)] border border-[var(--color-border)] text-[var(--color-text-secondary)]'\n                    }`}\n                  >\n                    <div className=\"whitespace-pre-wrap\">{message.content}</div>\n                    <div className=\"mt-2 text-xs text-[var(--color-text-muted)] text-right\">{displayTime}</div>\n                  </div>\n                </div>\n              );\n            })\n          )}\n          {isLoading && (\n            <div className=\"flex items-center space-x-2 text-[var(--color-accent)]\">\n              <div className=\"w-2 h-2 bg-[var(--color-accent)] rounded-full animate-pulse\"></div>\n              <div className=\"w-2 h-2 bg-[var(--color-accent)] rounded-full animate-pulse delay-150\"></div>\n              <div className=\"w-2 h-2 bg-[var(--color-accent)] rounded-full animate-pulse delay-300\"></div>\n              <span className=\"ml-2 text-sm\">SELO DSP is thinking...</span>\n            </div>\n          )}\n          <div ref={messagesEndRef} />\n        </div>\n        {/* Input area */}\n        <form onSubmit={handleSubmit} className=\"mt-4\">\n          <div className=\"flex space-x-2\">\n            <input\n              type=\"text\"\n              value={input}\n              onChange={(e) => setInput(e.target.value)}\n              placeholder=\"Type your message...\"\n              className=\"flex-1 bg-[var(--color-bg-elev-1)] border border-[var(--color-border)] rounded-lg px-4 py-2 text-white focus:outline-none\"\n              disabled={isLoading}\n            />\n            {messages.length > 0 && (\n              <button\n                type=\"button\"\n                onClick={clearConversation}\n                className=\"px-4 py-2 bg-[var(--color-bg-elev-1)] hover:bg-[var(--color-bg-elev-2)] text-gray-400 hover:text-white border border-[var(--color-border)] rounded-lg font-medium transition-colors\"\n                title=\"Clear conversation\"\n              >\n                Clear\n              </button>\n            )}\n            <button\n              type=\"submit\"\n              disabled={!input.trim() || isLoading}\n              className=\"px-6 py-2 bg-[var(--color-bg-elev-1)] hover:bg-[var(--color-bg-elev-2)] text-[var(--color-accent)] border border-[var(--color-accent)]/50 rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              Send\n            </button>\n          </div>\n        </form>\n      </div>\n      {/* Reflection panel (right). Hidden on small screens to avoid overflow. */}\n      <div className=\"hidden md:block md:w-[420px] md:min-w-[320px] md:max-w-[520px] h-full border-l border-[var(--color-border)] bg-[var(--color-bg-elev-1)]\">\n        <ReflectionPanel sessionId={sessionId} messages={messages} />\n      </div>\n    </div>\n  );\n};\n\nexport default Chat;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}