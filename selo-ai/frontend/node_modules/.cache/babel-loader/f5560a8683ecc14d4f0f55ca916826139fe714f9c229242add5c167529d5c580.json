{"ast":null,"code":"// Runtime config loader for frontend\n// Priority: env (REACT_APP_API_URL/VITE_API_URL) -> /config.json -> window-derived fallback.\nlet cachedConfig=null;let inflightPromise=null;export async function getConfig(){if(cachedConfig)return cachedConfig;if(inflightPromise)return inflightPromise;// 1) Environment variables (CRA/Vite) at build-time/runtime\nconst envApi=process.env.REACT_APP_API_URL||process.env.VITE_API_URL;if(envApi){cachedConfig={apiBaseUrl:envApi};return cachedConfig;}// 2) Runtime config.json from the same origin\ninflightPromise=(async()=>{try{const res=await fetch('/config.json',{cache:'no-store'});if(!res.ok)throw new Error(`Failed to load config.json: ${res.status}`);const data=await res.json();// Basic shape validation\nif(!data||typeof data.apiBaseUrl!=='string'||!data.apiBaseUrl){throw new Error('Invalid config.json contents');}cachedConfig=data;return cachedConfig;}catch(err){console.warn('Runtime config load failed, falling back:',err);// 3) Fallback: infer API URL from window location\ntry{const{protocol,hostname,port}=window.location;// If frontend on 3000, assume backend on 8000; otherwise reuse port if present\nlet backendPort='8000';if(port&&port!=='3000'&&port!=='80'&&port!=='443'){backendPort=port;}else if(!port&&(protocol==='http:'||protocol==='https:')){// keep default 8000 when standard ports\nbackendPort='8000';}const fallback=`${protocol}//${hostname}:${backendPort}`;cachedConfig={apiBaseUrl:fallback};return cachedConfig;}catch(e){// Final hard fallback\ncachedConfig={apiBaseUrl:'http://localhost:8000'};return cachedConfig;}}finally{inflightPromise=null;}})();return inflightPromise;}export async function getApiBaseUrl(){const cfg=await getConfig();return cfg.apiBaseUrl;}","map":{"version":3,"names":["cachedConfig","inflightPromise","getConfig","envApi","process","env","REACT_APP_API_URL","VITE_API_URL","apiBaseUrl","res","fetch","cache","ok","Error","status","data","json","err","console","warn","protocol","hostname","port","window","location","backendPort","fallback","e","getApiBaseUrl","cfg"],"sources":["/mnt/local/Projects/SELODSP1/selo-ai/frontend/src/services/config.js"],"sourcesContent":["// Runtime config loader for frontend\n// Priority: env (REACT_APP_API_URL/VITE_API_URL) -> /config.json -> window-derived fallback.\n\nlet cachedConfig = null;\nlet inflightPromise = null;\n\nexport async function getConfig() {\n  if (cachedConfig) return cachedConfig;\n  if (inflightPromise) return inflightPromise;\n\n  // 1) Environment variables (CRA/Vite) at build-time/runtime\n  const envApi = process.env.REACT_APP_API_URL || process.env.VITE_API_URL;\n  if (envApi) {\n    cachedConfig = { apiBaseUrl: envApi };\n    return cachedConfig;\n  }\n\n  // 2) Runtime config.json from the same origin\n  inflightPromise = (async () => {\n    try {\n      const res = await fetch('/config.json', { cache: 'no-store' });\n      if (!res.ok) throw new Error(`Failed to load config.json: ${res.status}`);\n      const data = await res.json();\n      // Basic shape validation\n      if (!data || typeof data.apiBaseUrl !== 'string' || !data.apiBaseUrl) {\n        throw new Error('Invalid config.json contents');\n      }\n      cachedConfig = data;\n      return cachedConfig;\n    } catch (err) {\n      console.warn('Runtime config load failed, falling back:', err);\n      // 3) Fallback: infer API URL from window location\n      try {\n        const { protocol, hostname, port } = window.location;\n        // If frontend on 3000, assume backend on 8000; otherwise reuse port if present\n        let backendPort = '8000';\n        if (port && port !== '3000' && port !== '80' && port !== '443') {\n          backendPort = port;\n        } else if (!port && (protocol === 'http:' || protocol === 'https:')) {\n          // keep default 8000 when standard ports\n          backendPort = '8000';\n        }\n        const fallback = `${protocol}//${hostname}:${backendPort}`;\n        cachedConfig = { apiBaseUrl: fallback };\n        return cachedConfig;\n      } catch (e) {\n        // Final hard fallback\n        cachedConfig = { apiBaseUrl: 'http://localhost:8000' };\n        return cachedConfig;\n      }\n    } finally {\n      inflightPromise = null;\n    }\n  })();\n\n  return inflightPromise;\n}\n\nexport async function getApiBaseUrl() {\n  const cfg = await getConfig();\n  return cfg.apiBaseUrl;\n}\n"],"mappings":"AAAA;AACA;AAEA,GAAI,CAAAA,YAAY,CAAG,IAAI,CACvB,GAAI,CAAAC,eAAe,CAAG,IAAI,CAE1B,MAAO,eAAe,CAAAC,SAASA,CAAA,CAAG,CAChC,GAAIF,YAAY,CAAE,MAAO,CAAAA,YAAY,CACrC,GAAIC,eAAe,CAAE,MAAO,CAAAA,eAAe,CAE3C;AACA,KAAM,CAAAE,MAAM,CAAGC,OAAO,CAACC,GAAG,CAACC,iBAAiB,EAAIF,OAAO,CAACC,GAAG,CAACE,YAAY,CACxE,GAAIJ,MAAM,CAAE,CACVH,YAAY,CAAG,CAAEQ,UAAU,CAAEL,MAAO,CAAC,CACrC,MAAO,CAAAH,YAAY,CACrB,CAEA;AACAC,eAAe,CAAG,CAAC,SAAY,CAC7B,GAAI,CACF,KAAM,CAAAQ,GAAG,CAAG,KAAM,CAAAC,KAAK,CAAC,cAAc,CAAE,CAAEC,KAAK,CAAE,UAAW,CAAC,CAAC,CAC9D,GAAI,CAACF,GAAG,CAACG,EAAE,CAAE,KAAM,IAAI,CAAAC,KAAK,CAAC,+BAA+BJ,GAAG,CAACK,MAAM,EAAE,CAAC,CACzE,KAAM,CAAAC,IAAI,CAAG,KAAM,CAAAN,GAAG,CAACO,IAAI,CAAC,CAAC,CAC7B;AACA,GAAI,CAACD,IAAI,EAAI,MAAO,CAAAA,IAAI,CAACP,UAAU,GAAK,QAAQ,EAAI,CAACO,IAAI,CAACP,UAAU,CAAE,CACpE,KAAM,IAAI,CAAAK,KAAK,CAAC,8BAA8B,CAAC,CACjD,CACAb,YAAY,CAAGe,IAAI,CACnB,MAAO,CAAAf,YAAY,CACrB,CAAE,MAAOiB,GAAG,CAAE,CACZC,OAAO,CAACC,IAAI,CAAC,2CAA2C,CAAEF,GAAG,CAAC,CAC9D;AACA,GAAI,CACF,KAAM,CAAEG,QAAQ,CAAEC,QAAQ,CAAEC,IAAK,CAAC,CAAGC,MAAM,CAACC,QAAQ,CACpD;AACA,GAAI,CAAAC,WAAW,CAAG,MAAM,CACxB,GAAIH,IAAI,EAAIA,IAAI,GAAK,MAAM,EAAIA,IAAI,GAAK,IAAI,EAAIA,IAAI,GAAK,KAAK,CAAE,CAC9DG,WAAW,CAAGH,IAAI,CACpB,CAAC,IAAM,IAAI,CAACA,IAAI,GAAKF,QAAQ,GAAK,OAAO,EAAIA,QAAQ,GAAK,QAAQ,CAAC,CAAE,CACnE;AACAK,WAAW,CAAG,MAAM,CACtB,CACA,KAAM,CAAAC,QAAQ,CAAG,GAAGN,QAAQ,KAAKC,QAAQ,IAAII,WAAW,EAAE,CAC1DzB,YAAY,CAAG,CAAEQ,UAAU,CAAEkB,QAAS,CAAC,CACvC,MAAO,CAAA1B,YAAY,CACrB,CAAE,MAAO2B,CAAC,CAAE,CACV;AACA3B,YAAY,CAAG,CAAEQ,UAAU,CAAE,uBAAwB,CAAC,CACtD,MAAO,CAAAR,YAAY,CACrB,CACF,CAAC,OAAS,CACRC,eAAe,CAAG,IAAI,CACxB,CACF,CAAC,EAAE,CAAC,CAEJ,MAAO,CAAAA,eAAe,CACxB,CAEA,MAAO,eAAe,CAAA2B,aAAaA,CAAA,CAAG,CACpC,KAAM,CAAAC,GAAG,CAAG,KAAM,CAAA3B,SAAS,CAAC,CAAC,CAC7B,MAAO,CAAA2B,GAAG,CAACrB,UAAU,CACvB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}